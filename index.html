<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jackie's Curse Counter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    button.curse-btn {
      margin: 10px;
      padding: 15px 25px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #ff4d4d;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    button.curse-btn:hover {
      background-color: #cc0000;
    }
    .leaderboards {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    .board {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .board h2 {
      margin-top: 0;
      color: #333;
    }
    .board ul {
      list-style: none;
      padding: 0;
      text-align: left;
    }
    .board li {
      margin: 8px 0;
      padding: 8px;
      background: #f9f9f9;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
    }
    .counters {
      margin: 20px 0;
      font-size: 18px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    #buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .reset-btn {
      background-color: #666;
      margin-top: 30px;
      padding: 10px 20px;
      font-size: 16px;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .reset-btn:hover {
      background-color: #444;
    }
  </style>
</head>
<body>
  <h1>Jackie's Curse Counter</h1>
  <div class="counters">
    <p>Today: <strong><span id="todayCount">0</span></strong> | Total: <strong><span id="totalCount">0</span></strong></p>
  </div>
  
  <div id="buttons"></div>

  <div class="leaderboards">
    <div class="board">
      <h2>Today's Top Curses</h2>
      <ul id="todayBoard"><li>No curses yet today</li></ul>
    </div>
    <div class="board">
      <h2>All-Time Top Curses</h2>
      <ul id="allTimeBoard"><li>No curses recorded yet</li></ul>
    </div>
  </div>

  <button class="reset-btn" onclick="resetData()">Reset All Data</button>

  <script>
    // Webhook URL
    const webhookURL = "https://discord.com/api/webhooks/1378646229256241222/6BllgbinjkqsWmYFl7Chop-RGRUdTGOjwiPrOVZxenAMKGCrI3ziok791OPVjL9qXBJZ";

    const curseWords = [
      { label: "f*ck", full: "fuck" },
      { label: "sh*t", full: "shit" },
      { label: "b*tch", full: "bitch" },
      { label: "a**", full: "ass" },
      { label: "d*ck", full: "dick" },
      { label: "r-word", full: "rape" },
      { label: "slur-HR", full: "Hard R" },
      { label: "slur-SR", full: "Soft R" },
      { label: "G-slur", full: "a general slur" }
    ];

    // DOM elements
    const todayCountEl = document.getElementById("todayCount");
    const totalCountEl = document.getElementById("totalCount");
    const todayBoardEl = document.getElementById("todayBoard");
    const allTimeBoardEl = document.getElementById("allTimeBoard");

    // Improved date handling
    function getTodayKey() {
      const now = new Date();
      return now.toISOString().split('T')[0]; // YYYY-MM-DD format
    }

    // Initialize or load data with proper structure
    function initializeData() {
      const todayKey = getTodayKey();
      let data = JSON.parse(localStorage.getItem("curseData")) || {
        total: 0,
        days: {},
        allTime: { words: {} }
      };

      // Ensure days object exists
      if (!data.days) data.days = {};
      
      // Initialize today's data if missing or if date changed
      if (!data.days[todayKey] || typeof data.days[todayKey] !== 'object') {
        data.days[todayKey] = {
          count: 0,
          words: {}
        };
      }

      // Ensure allTime words object exists
      if (!data.allTime || typeof data.allTime !== 'object') {
        data.allTime = { words: {} };
      }
      if (!data.allTime.words || typeof data.allTime.words !== 'object') {
        data.allTime.words = {};
      }

      return data;
    }

    let data = initializeData();
    const todayKey = getTodayKey();

    // Save data to localStorage
    function saveData() {
      localStorage.setItem("curseData", JSON.stringify(data));
      updateUI();
    }

    // Update all UI elements
    function updateUI() {
      // Update counters
      todayCountEl.textContent = data.days[todayKey].count;
      totalCountEl.textContent = data.total;

      // Update today's leaderboard
      updateLeaderboard(todayBoardEl, data.days[todayKey].words);
      
      // Update all-time leaderboard
      updateLeaderboard(allTimeBoardEl, data.allTime.words);
    }

    // Update a leaderboard element with word counts
    function updateLeaderboard(element, wordsData) {
      element.innerHTML = '';
      
      const entries = Object.entries(wordsData);
      
      if (entries.length === 0) {
        element.innerHTML = '<li>No data available</li>';
        return;
      }
      
      // Sort by count (descending)
      entries.sort((a, b) => b[1] - a[1]);
      
      // Add top 10 entries
      entries.slice(0, 10).forEach(([word, count]) => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${word}</span><span>${count}</span>`;
        element.appendChild(li);
      });
    }

    // Handle curse button click
    function handleCurse(wordObj) {
      // Update counts
      data.total++;
      data.days[todayKey].count++;
      
      // Update word counts
      data.days[todayKey].words[wordObj.full] = (data.days[todayKey].words[wordObj.full] || 0) + 1;
      data.allTime.words[wordObj.full] = (data.allTime.words[wordObj.full] || 0) + 1;
      
      // Save and update
      saveData();
      
      // Send webhook
      sendWebhook(wordObj.full);
      
      // Visual feedback
      const btn = document.querySelector(`button[data-word="${wordObj.full}"]`);
      if (btn) {
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => { btn.style.transform = 'scale(1)'; }, 100);
      }
    }

    // Send webhook with error handling
    function sendWebhook(word) {
      const message = {
        content: `Jackie said "${word}". Today's count: ${data.days[todayKey].count}. All-time total: ${data.total}.`
      };
      
      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(message)
      }).catch(err => {
        console.error("Failed to send webhook:", err);
      });
    }

    // Reset all data
    function resetData() {
      if (confirm("Are you sure you want to reset ALL curse counter data? This cannot be undone!")) {
        data = {
          total: 0,
          days: { [todayKey]: { count: 0, words: {} } },
          allTime: { words: {} }
        };
        saveData();
        alert("All data has been reset!");
      }
    }

    // Create buttons
    function createButtons() {
      const buttonContainer = document.getElementById('buttons');
      if (!buttonContainer) return;
      
      buttonContainer.innerHTML = '';
      
      curseWords.forEach(wordObj => {
        const btn = document.createElement('button');
        btn.className = 'curse-btn';
        btn.textContent = wordObj.label;
        btn.setAttribute('data-word', wordObj.full);
        btn.onclick = () => handleCurse(wordObj);
        buttonContainer.appendChild(btn);
      });
    }

    // Initialize the app
    window.onload = function() {
      // Ensure data is properly initialized
      data = initializeData();
      saveData(); // Save any initialized structure
      
      createButtons();
      updateUI();
    };
  </script>
</body>
</html>
